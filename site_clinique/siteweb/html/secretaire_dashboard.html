<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tableau de bord - Secrétaire</title>
  <link rel="stylesheet" href="../css/secretaire_dashboard.css">
  <script src="../script/secretaire_dashboard.js" defer></script>

</head>
<body>

  <header>
    <div class="logo-container">
      <img src="../image/logo.png" alt="Logo FIX-SANTÉ" class="logo">
      <h1>Clinique VITALIS – Espace Secrétaire</h1>
    </div>
  </header>

  <nav class="tabs">
    <button onclick="showTab('rdv')">Rendez-vous</button>
    <button onclick="showTab('creation')">Créer un RDV</button>
    <button onclick="showTab('patients')">Informations patients</button>
  </nav>

  <main>
    <!-- Rendez-vous -->
    <section id="rdv" class="tab-content">
      <h2>Rendez-vous de la clinique</h2>
      <table>
        <thead>
          <tr>
            <th>Date</th><th>Heure</th><th>Patient</th><th>Professionnel</th><th>Service</th><th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>2025-07-15</td><td>09:00</td><td>Jean Dupont</td><td>Dr. Tremblay</td><td>Consultation</td>
            <td><button>Modifier</button> <button class="danger">Annuler</button></td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Création de rendez-vous -->
    <section id="creation" class="tab-content hidden">
      <h2>Créer un rendez-vous</h2>
      <label>Nom du patient :</label>
      <input type="text">

      <label>Professionnel :</label>
      <select>
        <option>Dr. Tremblay</option>
        <option>Infirmière Julie</option>
      </select>

      <label>Date :</label>
      <input type="date">

      <label>Heure :</label>
      <input type="time">

      <label>Service :</label>
      <input type="text">

      <button>Créer le rendez-vous</button>
    </section>

    
    <!-- Infos patients -->
    <section id="patients" class="tab-content hidden">
      <h2>Informations des patients</h2>
      <table>
        <thead>
          <tr>
            <th>Nom</th><th>Date de naissance</th><th>Numéro d'assurance maladie</th><th>Contact</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <!--A Remplir avec la base de données-->
          </tr>
        </tbody>
      </table>
    </section>
  </main>

  <script src="../script/get_handle_data.js"></script>
<script>
  const API_URL = "http://localhost/api/"; // adapte si nécessaire

  document.addEventListener("DOMContentLoaded", () => {
    chargerRendezVous();
  });

  function showTab(id) {
    document.querySelectorAll(".tab-content").forEach(sec => sec.classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
  }

  async function chargerRendezVous() {
    try {
        const response = await fetch(`${API_URL}rendezvous`);
        if (!response.ok) throw new Error("Échec du chargement des rendez-vous");

        const rendezvous = await response.json();
        const tbody = document.querySelector("#rdv tbody");
        tbody.innerHTML = "";

        if (rendezvous.length === 0) {
            tbody.innerHTML = `<tr><td colspan="6">Aucun rendez-vous</td></tr>`;
            return;
        }

        rendezvous.forEach(rdv => {
            const row = document.createElement("tr");

            // Nom selon le poste
            let nomAffiche;
            if (rdv.POSTE === "Médecin") {
                nomAffiche = `Dr. ${rdv.NOM_EMPLOYE}`;
            } else {
                nomAffiche = rdv.NOM_EMPLOYE;
            }

            row.innerHTML = `
                <td>${rdv.DATE_RDV}</td>
                <td>${rdv.HEURE}</td>
                <td>${rdv.COURRIEL}</td>
                <td>${nomAffiche}</td>
                <td>${rdv.service}</td>
                <td>
                    <button onclick="modifierRdv(${rdv.NUM_RDV})">Modifier</button>
                    <button class="danger" onclick="annulerRdv(${rdv.NUM_RDV})">Annuler</button>
                </td>
            `;

            tbody.appendChild(row);
        });

    } catch (err) {
        console.error("Erreur lors du chargement des RDV :", err);
    }
  }

  function modifierRdv(numRdv) {
    alert("Modifier le rendez-vous #" + numRdv);
    // Tu peux pré-remplir le formulaire de création ici si tu veux permettre l'édition.
  }

  function annulerRdv(numRdv) {
    if (confirm("Voulez-vous vraiment annuler ce rendez-vous ?")) {
        fetch(`${API_URL}rendezvous/${numRdv}`, {
            method: "DELETE"
        })
        .then(res => {
            if (!res.ok) throw new Error("Échec de l'annulation");
            return res.json();
        })
        .then(() => {
            chargerRendezVous(); // Recharger après suppression
        })
        .catch(err => {
            alert("Erreur : " + err.message);
        });
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
  chargerRendezVous();
  chargerPatients(); // On charge les infos des patients ici
});

async function chargerPatients() {
  try {
    const response = await fetch(`${API_URL}patients`); // adapte le chemin à ton endpoint exact
    if (!response.ok) throw new Error("Échec du chargement des patients");

    const patients = await response.json();
    const tbody = document.querySelector("#patients tbody");
    tbody.innerHTML = "";

    if (patients.length === 0) {
      tbody.innerHTML = `<tr><td colspan="4">Aucun patient trouvé</td></tr>`;
      return;
    }

    patients.forEach(p => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${p.PRENOM_PATIENT} ${p.NOM_PATIENT}</td>
        <td>${p.DATE_NAISSANCE}</td>
        <td>${p.NO_ASSURANCE_MALADIE}</td>
        <td>${p.NUM_TEL} / ${p.COURRIEL}</td>
      `;
      tbody.appendChild(row);
    });

  } catch (err) {
    console.error("Erreur lors du chargement des patients :", err);
  }
}


</script>



</body>
</html>
