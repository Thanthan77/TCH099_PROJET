<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Tableau de bord - Administrateur</title>
  <link rel="stylesheet" href="../css/admin_dashboard.css" />
</head>
<body>

  <header>
    <div class="logo-container">
      <img src="../image/logo.png" alt="Logo Clinique Vitalis" class="logo" />
      <h1>Clinique VITALIS – Espace Administrateur</h1>
    </div>
  </header>

  <nav class="tabs">
    <button onclick="showTab('comptes')">Comptes utilisateurs</button>
    <button onclick="showTab('vacances')">Demandes de vacances</button>
    <button onclick="showTab('secretaires')">Assignation secrétaires</button>
    <button onclick="showTab('infirmiers')">Assignation infirmiers</button>
  </nav>

  <main>
    <!-- Comptes -->
    <section id="comptes" class="tab-content">
      <h2>Comptes utilisateurs</h2>
      <table>
        <thead>
          <tr>
            <th>Nom</th><th>Code Employé</th><th>Rôle</th><th>Actions</th>
          </tr>
        </thead>
        <tbody id="employe-table-body">
          <!-- rempli dynamiquement -->
        </tbody>
      </table>

      <h3>Ajouter un utilisateur</h3>
      <label>Nom :</label><input type="text" />
      <label>Code Employé :</label><input type="email" />
      <label>Rôle :</label>
      <select>
        <option>Médecin</option>
        <option>Infirmière</option>
        <option>Secrétaire</option>
        <option>Administrateur</option>
      </select>
      <button>Créer le compte</button>
    </section>

    <!-- Vacances -->
    <section id="vacances" class="tab-content hidden">
      <h2>Demandes de vacances</h2>
      <table>
        <thead>
          <tr>
            <th>Nom</th><th>Rôle</th><th>Début</th><th>Fin</th><th>Statut</th><th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Dr. Tremblay</td><td>Médecin</td><td>2025-08-01</td><td>2025-08-10</td><td>En attente</td>
            <td><button>Accepter</button> <button class="danger">Refuser</button></td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Secrétaires -->
    <section id="secretaires" class="tab-content hidden">
      <h2>Assignation des secrétaires</h2>
      <table>
        <thead>
          <tr>
            <th>Médecin</th><th>Secrétaire assignée</th><th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Dr. Lavoie</td><td>Aucune</td><td><button>Assigner</button></td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Infirmiers -->
    <section id="infirmiers" class="tab-content hidden">
      <h2>Assignation des infirmiers/infirmières</h2>
      <table>
        <thead>
          <tr>
            <th>Médecin</th><th>Infirmière assignée</th><th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Dr. Tremblay</td><td>Julie Roy</td><td><button>Modifier</button></td>
          </tr>
        </tbody>
      </table>
    </section>
  </main>

  <!-- (Optionnel) helper externe -->
  <script src="../script/get_handle_data.js"></script>

  <!-- JS corrigé -->
  <script>
    const API_URL = 'http://localhost/api/';
    
    document.addEventListener('DOMContentLoaded', () => {
      showTab('comptes');
      chargerAfficherComptes();
    });

    function showTab(id) {
      document.querySelectorAll('.tab-content').forEach(sec => {
        sec.classList.toggle('hidden', sec.id !== id);
      });
    }
    window.showTab = showTab;

    async function chargerAfficherComptes() {
      const tbody = document.getElementById('employe-table-body');
      if (!tbody) return console.error("Élément 'employe-table-body' introuvable");
      tbody.innerHTML = '';

      try {
        const res = await fetch(`${API_URL}employes`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const employes = await res.json();

        if (!Array.isArray(employes) || employes.length === 0) {
          tbody.innerHTML = '<tr><td colspan="4">Aucun employé trouvé</td></tr>';
          return;
        }

        tbody.innerHTML = employes.map(emp => `
          <tr>
            <td>${escapeHtml(emp.PRENOM_EMPLOYE)} ${escapeHtml(emp.NOM_EMPLOYE)}</td>
            <td>${escapeHtml(emp.CODE_EMPLOYE)}</td>
            <td>${escapeHtml(emp.POSTE)}</td>
            <td>
              <button onclick="modifierEmploye('${emp.CODE_EMPLOYE}')">Modifier</button>
              <button class="danger" onclick="supprimerEmploye('${emp.CODE_EMPLOYE}')">Supprimer</button>
            </td>
          </tr>
        `).join('');

      } catch (err) {
        console.error('Erreur chargement employés :', err);
        tbody.innerHTML = `
          <tr>
            <td colspan="4" class="error">
              Échec du chargement : ${escapeHtml(err.message)}
              <button onclick="chargerAfficherComptes()">Réessayer</button>
            </td>
          </tr>`;
      }
    }

    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, s => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'
      }[s]));
    }

    function modifierEmploye(code) {
      window.location.href = `modifier_employe.html?codeEmploye=${code}`;
    }

    function supprimerEmploye(code) {
      if (!confirm("Confirmer la suppression de l'employé ?")) return;
      // TODO : appeler DELETE `${API_URL}employes/${code}`
      alert("Suppression non implémentée");
    }
  </script>
</body>
</html>
