<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tableau de bord - Administrateur</title>
  <link rel="stylesheet" href="../css/admin_dashboard.css">
  <script src="../script/admin_dashboard.js" defer></script>
</head>
<body>

  <header>
    <div class="logo-container">
      <img src="../image/logo.png" alt="Logo Clinique Vitalis" class="logo">
      <h1>Clinique VITALIS – Espace Administrateur</h1>
    </div>
  </header>

  <nav class="tabs">
    <button onclick="showTab('comptes')">Comptes utilisateurs</button>
    <button onclick="showTab('vacances')">Demandes de vacances</button>
    <button onclick="showTab('secretaires')">Assignation secrétaires</button>
    <button onclick="showTab('infirmiers')">Assignation infirmiers</button>
  </nav>

  <main>
    <!-- Comptes -->
    <section id="comptes" class="tab-content">
      <h2>Comptes utilisateurs</h2>
      <table>
        <thead>
          <tr>
            <th>Nom</th><th>Code Employe</th><th>Rôle</th><th>Actions</th>
          </tr>
        </thead>
        <tbody id="employe-table-body">
          <tr>
            
          </tr>
        </tbody>
      </table>

      <h3>Ajouter un utilisateur</h3>
      <label>Nom :</label><input type="text">
      <label>Code Employe :</label><input type="email">
      <label>Rôle :</label>
      <select>
        <option>Médecin</option>
        <option>Infirmière</option>
        <option>Secrétaire</option>
        <option>Administrateur</option>
      </select>
      <button>Créer le compte</button>
    </section>

    <!-- Vacances -->
    <section id="vacances" class="tab-content hidden">
      <h2>Demandes de vacances</h2>
      <table>
        <thead>
          <tr>
            <th>Nom</th><th>Rôle</th><th>Début</th><th>Fin</th><th>Statut</th><th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Dr. Tremblay</td><td>Médecin</td><td>2025-08-01</td><td>2025-08-10</td><td>En attente</td>
            <td><button>Accepter</button> <button class="danger">Refuser</button></td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Secretaires -->
    <section id="secretaires" class="tab-content hidden">
      <h2>Assignation des secrétaires</h2>
      <table>
        <thead>
          <tr>
            <th>Médecin</th><th>Secrétaire assignée</th><th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Dr. Lavoie</td><td>Aucune</td><td><button>Assigner</button></td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Infirmiers -->
    <section id="infirmiers" class="tab-content hidden">
      <h2>Assignation des infirmiers/infirmières</h2>
      <table>
        <thead>
          <tr>
            <th>Médecin</th><th>Infirmière assignée</th><th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Dr. Tremblay</td><td>Julie Roy</td><td><button>Modifier</button></td>
          </tr>
        </tbody>
      </table>
    </section>
  </main>
<script src="../script/get_handle_data.js"></script>
  <script>

    const API_URL = 'http://localhost/api/';

    async function chargerAfficherEmployes() {
  try {
    const response = await fetch(`${API_URL}/employes`);
    if (!response.ok) throw new Error(`Erreur HTTP: ${response.status}`);

    const employes = await response.json();
    const tbody = document.getElementById('employe-table-body');
    if (!tbody) throw new Error("Élément 'employe-table-body' non trouvé");

    if (employes.length === 0) {
      tbody.innerHTML = '<tr><td colspan="4">Aucun employé trouvé</td></tr>';
      return;
    }

    tbody.innerHTML = employes.map(emp => `
      <tr>
        <td>${escapeHtml(emp.nom)}</td>
        <td>${escapeHtml(emp.code_employe)}</td>
        <td>${escapeHtml(emp.role)}</td>
        <td>
          <button onclick="modifierEmploye(${emp.id})">Modifier</button>
          <button class="danger" onclick="supprimerEmploye(${emp.id})">Supprimer</button>
        </td>
      </tr>
    `).join('');
  } catch (error) {
    console.error('Erreur:', error.message);
    const tbody = document.getElementById('employe-table-body');
    if (tbody) {
      tbody.innerHTML = `
        <tr>
          <td colspan="4" class="error">
            Échec du chargement : ${error.message}
            <button onclick="chargerAfficherEmployes()">Réessayer</button>
          </td>
        </tr>
      `;
    }
  }
}

function escapeHtml(text) {
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;',
  };
  return text.replace(/[&<>"']/g, m => map[m]);
}

document.addEventListener('DOMContentLoaded', () => {
  chargerAfficherEmployes();
});


  </script>

</body>
</html>
